!function(window){"use strict";window.JCNewsListPromoComponent||(window.JCNewsListPromoComponent=function(t){this.formPosting=!1,this.imgLazyLoad=t.imgLazyLoad||"",this.siteId=t.siteId||"",this.template=t.template||"",this.templatePath=t.templatePath||"",this.parameters=t.parameters||"",t.navParams&&(this.navParams={NavNum:t.navParams.NavNum||1,NavPageNomer:parseInt(t.navParams.NavPageNomer)||1,NavPageCount:parseInt(t.navParams.NavPageCount)||1}),this.container=document.querySelector("[data-entity='container-"+this.navParams.NavNum+"']"),this.showMoreButton=null,this.showMoreButtonMessage=null,this.showMoreButtonContainer=null,t.lazyLoad&&(this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]'),this.showMoreButtonMessage=this.showMoreButton.innerHTML,this.showMoreButtonContainer=document.querySelector('[data-entity="promotions-show-more-container"]'),BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this))),BX.ready(BX.delegate(this.init,this))},window.JCNewsListPromoComponent.prototype={init:function(){var items=this.container.querySelectorAll(".promotions-item");for(var i in items)if(items.hasOwnProperty(i)&&BX.type.isDomNode(items[i])){var itemTimer=items[i].querySelector('[data-entity="timer"]');if(itemTimer){var itemActiveToStr=itemTimer.getAttribute("data-active-to"),itemActiveTo=eval("("+itemActiveToStr+")");Object.keys(itemActiveTo).length>0&&$(itemTimer).countdown({until:new Date(itemActiveTo.YYYY,itemActiveTo.MM-1,itemActiveTo.DD,itemActiveTo.HH?itemActiveTo.HH:"00",itemActiveTo.MI?itemActiveTo.MI:"00"),padZeroes:!0,expiryText:BX.message("PROMOTIONS_ITEM_COMPLETED"),alwaysExpire:!0})}}},checkButton:function(){this.showMoreButton&&(this.navParams.NavPageNomer==this.navParams.NavPageCount?BX.remove(this.showMoreButtonContainer):this.container.appendChild(this.showMoreButtonContainer))},enableButton:function(){this.showMoreButton&&(BX.removeClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=this.showMoreButtonMessage)},disableButton:function(){this.showMoreButton&&(BX.addClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=BX.message("PROMOTIONS_LOADING"))},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var t={action:"showMorePromo"};t.REQUEST_URI=window.location.pathname,t["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1,this.formPosting||(this.formPosting=!0,this.disableButton(),this.sendRequest(t))}},sendRequest:function(t){var e={siteId:this.siteId,template:this.template,parameters:this.parameters};BX.ajax({url:this.templatePath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(e,t),onsuccess:BX.delegate(function(t){t&&t.JS&&BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate(function(){this.processShowMoreAction(t)},this))},this)})},processShowMoreAction:function(t){this.formPosting=!1,this.enableButton(),t&&(this.navParams.NavPageNomer++,this.processItems(t.items),this.processPagination(t.pagination),this.checkButton())},processItems:function(t,e){if(t){var i,o=BX.processHTML(t,!1),a=BX.create("DIV");if(a.innerHTML=o.HTML,(i=a.querySelectorAll('[data-entity="item"]')).length){for(var s in i)if(i.hasOwnProperty(s)){if(this.imgLazyLoad){var n=i[s].querySelectorAll("img");if(n)for(var r in n)if(n.hasOwnProperty(r)){var h=n[r].getAttribute("src");h&&(n[r].removeAttribute("src"),n[r].setAttribute("data-lazyload-src",h))}}i[s].style.opacity=0,this.container.appendChild(i[s])}this.imgLazyLoad&&imgLazyLoad(),new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){for(var e in i)i.hasOwnProperty(e)&&(i[e].style.opacity=t.opacity/100)},complete:function(){for(var t in i)i.hasOwnProperty(t)&&i[t].removeAttribute("style")}}).animate()}BX.ajax.processScripts(o.SCRIPT)}},processPagination:function(t){if(t){var e=document.querySelector('[data-pagination-num="'+this.navParams.NavNum+'"]');e&&(e.innerHTML=t)}}}),window.JCNewsListPromo||(window.JCNewsListPromo=function(t){this.visual={ID:""},this.item={activeTo:{}},this.obItem=null,this.errorCode=0,"object"==typeof t&&(this.visual=t.VISUAL,this.item.activeTo=t.ITEM.ACTIVE_TO,BX.ready(BX.delegate(this.init,this)))},window.JCNewsListPromo.prototype={init:function(){if(this.obItem=BX(this.visual.ID),this.obItem||(this.errorCode=-1),0===this.errorCode){var t=this.obItem.querySelector('[data-entity="timer"]');t&&$(t).countdown({until:new Date(this.item.activeTo.YYYY,this.item.activeTo.MM-1,this.item.activeTo.DD,this.item.activeTo.HH?this.item.activeTo.HH:"00",this.item.activeTo.MI?this.item.activeTo.MI:"00"),padZeroes:!0,expiryText:BX.message("PROMOTIONS_ITEM_COMPLETED"),alwaysExpire:!0})}}})}(window);