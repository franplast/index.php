!function(e){"use strict";e.JCNewsListReviewsComponent||(e.JCNewsListReviewsComponent=function(e){this.formPosting=!1,this.siteId=e.siteId||"",this.template=e.template||"",this.templatePath=e.templatePath||"",this.parameters=e.parameters||"",e.navParams&&(this.navParams={NavNum:e.navParams.NavNum||1,NavPageNomer:parseInt(e.navParams.NavPageNomer)||1,NavPageCount:parseInt(e.navParams.NavPageCount)||1}),this.container=document.querySelector("[data-entity='container-"+this.navParams.NavNum+"']"),this.showMoreButton=null,this.showMoreButtonMessage=null,this.showMoreButtonContainer=null,e.lazyLoad&&(this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]'),this.showMoreButtonMessage=this.showMoreButton.innerHTML,this.showMoreButtonContainer=document.querySelector('[data-entity="reviews-show-more-container"]'),BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this))),this.evaluationStars=document.body.querySelector(".reviews-evaluation-stars"),this.evaluationStars&&BX.ready(BX.delegate(this.initEvaluationStars,this)),this.addReviewButton=document.body.querySelector('[data-entity="addReview"]'),this.addReviewButton&&BX.bind(this.addReviewButton,"click",BX.proxy(this.addReview,this)),this.ratingList=document.body.querySelector(".reviews-general-stats-rating-list"),this.ratingList&&BX.ready(BX.delegate(this.initRatingList,this)),BX.addCustomEvent(this,"addReviewRequest",BX.proxy(this.addReviewRequest,this))},e.JCNewsListReviewsComponent.prototype={checkButton:function(){this.showMoreButton&&(this.navParams.NavPageNomer==this.navParams.NavPageCount?BX.remove(this.showMoreButtonContainer):this.container.appendChild(this.showMoreButtonContainer))},enableButton:function(){this.showMoreButton&&(BX.removeClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=this.showMoreButtonMessage)},disableButton:function(){this.showMoreButton&&(BX.addClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=BX.message("REVIEWS_LOADING"))},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var t={action:"showMoreReviews"};t.REQUEST_URI=e.location.pathname,t["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1,this.formPosting||(this.formPosting=!0,this.disableButton(),this.sendRequest(t))}},sendRequest:function(e){var t={siteId:this.siteId,template:this.template,parameters:this.parameters},s=!!this.ratingList&&this.ratingList.querySelectorAll(".reviews-general-stats-rating-item-container");if(s)for(var i in s)s.hasOwnProperty(i)&&BX.type.isDomNode(s[i])&&BX.hasClass(s[i],"active")&&(t.ratingId=s[i].getAttribute("data-rating-id"));BX.ajax({url:this.templatePath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(t,e),onsuccess:BX.delegate(function(e){e&&e.JS&&BX.ajax.processScripts(BX.processHTML(e.JS).SCRIPT,!1,BX.delegate(function(){this.processShowMoreAction(e)},this))},this)})},processShowMoreAction:function(e){this.formPosting=!1,this.enableButton(),e&&(this.navParams.NavPageNomer++,this.processItems(e.items),this.checkButton())},processItems:function(e,t){if(e){var s,i=BX.processHTML(e,!1),a=BX.create("DIV");if(a.innerHTML=i.HTML,(s=a.querySelectorAll('[data-entity="item"]')).length){for(var o in s)s.hasOwnProperty(o)&&(s[o].style.opacity=0,this.container.appendChild(s[o]));new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){for(var t in s)s.hasOwnProperty(t)&&(s[t].style.opacity=e.opacity/100)},complete:function(){for(var e in s)s.hasOwnProperty(e)&&s[e].removeAttribute("style")}}).animate()}BX.ajax.processScripts(i.SCRIPT)}},initEvaluationStars:function(){var e=this.evaluationStars.querySelectorAll(".reviews-evaluation-star"),t=document.body.querySelector(".reviews-evaluation-val");e&&(BX.bind(this.evaluationStars,"click",BX.delegate(function(t){var s=t.target;if(BX.hasClass(s,"reviews-evaluation-star")){for(var i in e)e.hasOwnProperty(i)&&BX.type.isDomNode(e[i])&&BX.removeClass(e[i],"reviews-evaluation-star-current");BX.addClass(s,"reviews-evaluation-star-current"),this.addReview(t)}},this)),BX.bind(this.evaluationStars,"mouseover",BX.delegate(function(s){var i=s.target;if(BX.hasClass(i,"reviews-evaluation-star")){for(var a in t&&(t.innerHTML=i.getAttribute("data-value")),e)e.hasOwnProperty(a)&&BX.type.isDomNode(e[a])&&BX.removeClass(e[a],"reviews-evaluation-star-active");for(var a in BX.addClass(i,"reviews-evaluation-star-active"),e)if(e.hasOwnProperty(a)&&BX.type.isDomNode(e[a])){if(BX.hasClass(e[a],"reviews-evaluation-star-active"))break;BX.addClass(e[a],"reviews-evaluation-star-active")}}},this)),BX.bind(this.evaluationStars,"mouseout",BX.delegate(function(){for(var s in t&&(t.innerHTML=BX.message("REVIEWS_EVALUATION_VALUE")),e)e.hasOwnProperty(s)&&BX.type.isDomNode(e[s])&&BX.addClass(e[s],"reviews-evaluation-star-active");for(s=Object.keys(e).length;s>=0;s--)if(e.hasOwnProperty(s)&&BX.type.isDomNode(e[s])){if(BX.hasClass(e[s],"reviews-evaluation-star-current")){t&&(t.innerHTML=e[s].getAttribute("data-value"));break}BX.removeClass(e[s],"reviews-evaluation-star-active")}},this)))},addReviewRequest:function(e,t){var s={action:"addReviewRequest",parameters:this.parameters};if(BX.hasClass(e,"reviews-evaluation-stars")){var i=e.querySelectorAll(".reviews-evaluation-star");if(i)for(var a in i)i.hasOwnProperty(a)&&BX.type.isDomNode(i[a])&&(BX.hasClass(i[a],"reviews-evaluation-star-current")&&(s.ratingId=i[a].getAttribute("data-rating-id")),BX.adjust(i[a],{props:{className:"icon-star-s reviews-evaluation-star"}}))}BX.ajax({url:this.templatePath+"/ajax.php",method:"POST",dataType:"json",timeout:60,data:s,onsuccess:BX.delegate(function(e){e.content&&e.JS?BX.ajax.processScripts(BX.processHTML(e.JS).SCRIPT,!1,BX.delegate(function(){var s=BX.processHTML(e.content);t.innerHTML=s.HTML,BX.ajax.processScripts(s.SCRIPT)},this)):(BX.cleanNode(t),t.appendChild(BX.create("DIV",{props:{className:"slide-panel__form"},children:[BX.create("DIV",{props:{className:"alert alert-error alert-show"},html:BX.message("SLIDE_PANEL_UNDEFINED_ERROR")})]}))),$(t).scrollbar()},this)})},addReview:function(t){if(this.sPanel=document.body.querySelector(".slide-panel"),this.sPanel){this.sPanel.appendChild(BX.create("DIV",{props:{className:"slide-panel__title-wrap"},children:[BX.create("I",{props:{className:"icon-comment"}}),BX.create("SPAN",{props:{className:"slide-panel__title"},html:BX.message("REVIEWS_YOUR_REVIEW")}),BX.create("SPAN",{props:{className:"slide-panel__close"},children:[BX.create("I",{props:{className:"icon-close"}})]})]})),this.sPanel.appendChild(BX.create("DIV",{props:{className:"slide-panel__content scrollbar-inner"},children:[BX.create("DIV",{props:{className:"slide-panel__loader"},html:"<div><span></span></div>"})]}));var s=this.sPanel.querySelector(".slide-panel__content");s&&BX.onCustomEvent(this,"addReviewRequest",[BX.proxy_context,s]);var i=e.innerWidth-document.body.clientWidth;if(i>0){BX.style(document.body,"padding-right",i+"px");var a=document.querySelector(".page-bg");a&&BX.style(a,"margin-right",i+"px");var o=document.querySelector(".top-panel");if(o){BX.hasClass(o,"fixed")&&BX.style(o,"padding-right",i+"px");var r=o.querySelector(".top-panel__thead");r&&BX.hasClass(r,"fixed")&&BX.style(r,"padding-right",i+"px");var n=o.querySelector(".top-panel__tfoot");n&&BX.hasClass(n,"fixed")&&BX.style(n,"padding-right",i+"px")}var l=document.querySelector('[data-entity="tabs"]');l&&BX.hasClass(l,"fixed")&&BX.style(l,"padding-right",i+"px")}var h=BX.GetWindowScrollPos().scrollTop;h&&h>0&&BX.style(document.body,"top","-"+h+"px"),BX.addClass(document.body,"slide-panel-active"),BX.addClass(this.sPanel,"active"),document.body.appendChild(BX.create("DIV",{props:{className:"modal-backdrop slide-panel__backdrop fadeInBig"}})),t.stopPropagation()}},initRatingList:function(){var e=this.ratingList.querySelectorAll(".reviews-general-stats-rating-item-container");if(e)for(var t in e)e.hasOwnProperty(t)&&BX.type.isDomNode(e[t])&&(BX.hasClass(e[t],"disabled")||BX.bind(e[t],"click",BX.proxy(this.changeRatingItem,this)))},changeRatingItem:function(t){BX.PreventDefault(t);var s=BX.proxy_context&&BX.proxy_context.getAttribute("data-rating-id");if(!BX.hasClass(BX.proxy_context,"active")&&s){var i=document.body.querySelector(".reviews-items-container");i&&(i.style.opacity=.2,BX.ajax({url:this.templatePath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:{action:"changeRatingItem",REQUEST_URI:e.location.pathname,siteId:this.siteId,template:this.template,parameters:this.parameters,ratingId:s},onsuccess:BX.delegate(function(e){e&&e.JS&&BX.ajax.processScripts(BX.processHTML(e.JS).SCRIPT,!1,BX.delegate(function(){if(BX.cleanNode(i),e.items){var t=BX.processHTML(e.items,!1);(a=BX.create("DIV")).innerHTML=t.HTML;var s=a.querySelector(".reviews-items");s&&(i.appendChild(s),this.container=s),BX.ajax.processScripts(t.SCRIPT)}if(e.showMore){var a;(a=BX.create("DIV")).innerHTML=e.showMore;var o=a.querySelector(".reviews-more");o&&(i.appendChild(o),this.showMoreButtonContainer=o,this.showMoreButton=o.querySelector(".btn-more"),this.showMoreButtonMessage=this.showMoreButton.innerHTML,BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this)))}new BX.easing({duration:2e3,start:{opacity:20},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){i.style.opacity=e.opacity/100},complete:function(){i.removeAttribute("style")}}).animate()},this))},this)}));var a=this.ratingList.querySelectorAll(".reviews-general-stats-rating-item-container");if(a)for(var o in a)a.hasOwnProperty(o)&&BX.type.isDomNode(a[o])&&(a[o].getAttribute("data-rating-id")===s?BX.addClass(a[o],"active"):BX.removeClass(a[o],"active"))}}}),e.JCNewsListReviews||(e.JCNewsListReviews=function(e){this.visual={ID:""},this.item={iblockId:0,id:0},this.obItem=null,this.obLike=null,this.obLikes=null,this.errorCode=0,"object"==typeof e&&(this.visual=e.VISUAL,this.item.iblockId=e.ITEM.IBLOCK_ID,this.item.id=e.ITEM.ID,BX.ready(BX.delegate(this.init,this)))},e.JCNewsListReviews.prototype={init:function(){this.obItem=BX(this.visual.ID),this.obItem||(this.errorCode=-1),0===this.errorCode&&(this.checkLiked(),this.obLike=this.obItem.querySelector('[data-entity="like"]'),this.obLike&&BX.bind(this.obLike,"click",BX.proxy(this.like,this)),this.obLikes=this.obItem.querySelector(".reviews-item-likes"))},checkLiked:function(){BX.ajax({url:BX.message("REVIEWS_TEMPLATE_PATH")+"/ajax.php",method:"POST",dataType:"json",timeout:60,data:{action:"checkLiked",iblockId:this.item.iblockId,reviewId:this.item.id},onsuccess:BX.delegate(function(e){this.setLiked(!!e.liked)},this)})},like:function(){var e=BX.hasClass(this.obLike,"reviews-item-liked");BX.ajax({url:BX.message("REVIEWS_TEMPLATE_PATH")+"/ajax.php",method:"POST",dataType:"json",timeout:60,data:{action:e?"deleteLike":"addLike",iblockId:this.item.iblockId,reviewId:this.item.id},onsuccess:BX.delegate(function(e){this.setLiked(!!e.liked),e.likes&&this.setLikes(e.likes)},this)})},setLiked:function(e){if(this.obLike){e?BX.addClass(this.obLike,"reviews-item-liked"):BX.removeClass(this.obLike,"reviews-item-liked");var t=this.obLike.querySelector('[data-entity="like-icon"]');t&&BX.adjust(t,{props:{className:e?"icon-heart-s":"icon-heart-b"}})}},setLikes:function(e){if(this.obLikes)if("plus"==e)this.obLikes.innerHTML="+"+(parseInt(this.obLikes.innerHTML,10)+1),BX.hasClass(this.obLikes,"reviews-item-likes-empty")&&BX.removeClass(this.obLikes,"reviews-item-likes-empty");else if("minus"==e){var t=parseInt(this.obLikes.innerHTML,10)-1;this.obLikes.innerHTML=(t>0?"+":"")+t,0==t&&BX.addClass(this.obLikes,"reviews-item-likes-empty")}}})}(window);