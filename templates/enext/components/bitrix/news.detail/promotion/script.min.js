!function(){"use strict";window.JCNewsDetailPromo||(window.JCNewsDetailPromo=function(t){this.config={IMG_LAZYLOAD:!0,PARAMS:""},this.visual={ID:""},this.item={productsIds:""},this.obItem=null,this.obTabs=null,this.obTabsBlock=null,this.obTabContainers=null,this.obSectionsLinks=null,this.errorCode=0,"object"==typeof t&&(this.config=t.CONFIG,this.visual=t.VISUAL,this.item.productsIds=t.ITEM.PRODUCTS_IDS,BX.ready(BX.delegate(this.init,this)))},window.JCNewsDetailPromo.prototype={init:function(){this.obItem=BX(this.visual.ID),this.obItem||(this.errorCode=-1),0===this.errorCode&&(this.obTabs=this.obItem.querySelector(".promotions-detail-tabs-container"),this.obTabsBlock=!!this.obTabs&&this.obTabs.querySelector('[data-entity="tabs"]'),this.obTabContainers=this.obItem.querySelector(".promotions-detail-tabs-content"),this.obTabs&&(this.initTabs(),this.obTabsBlock&&(this.tabsPanelFixed=!1,this.tabsPanelScrolled=!1,this.lastScrollTop=0,this.checkTopTabsBlockScroll(),BX.bind(window,"scroll",BX.proxy(this.checkTopTabsBlockScroll,this)),BX.bind(window,"resize",BX.proxy(this.checkTopTabsBlockResize,this)),this.checkActiveTabsBlock(),BX.bind(window,"scroll",BX.proxy(this.checkActiveTabsBlock,this)),BX.bind(window,"resize",BX.proxy(this.checkActiveTabsBlock,this)))),this.itemTimer=this.obItem.querySelector('[data-entity="timer"]'),this.itemTimer&&this.initTimer(),this.obSectionsLinks=this.obItem.querySelector(".promotions-detail-sections-links"),this.obSectionsLinks&&this.initSectionsLinks())},initTabs:function(){var t,e,i=this.obTabs.querySelector(".promotions-detail-tabs-list"),s=!!i&&i.querySelectorAll('[data-entity="tab"]'),o=!1;if(i&&(BX.addClass(i,"owl-carousel"),$(i).owlCarousel({autoWidth:!0,nav:!0,navText:['<i class="icon-arrow-left"></i>','<i class="icon-arrow-right"></i>'],navContainer:".promotions-detail-tabs-scroll",dots:!1}),s))for(var a in s)s.hasOwnProperty(a)&&BX.type.isDomNode(s[a])&&(t=s[a].getAttribute("data-value"))&&(e=this.obTabContainers.querySelector('[data-value="'+t+'"]'),BX.type.isDomNode(e)&&(BX.bind(s[a],"click",BX.proxy(this.changeTab,this)),o?BX.removeClass(s[a],"active"):(BX.addClass(s[a],"active"),o=!0)))},checkTopTabsBlockScroll:function(){var t=document.querySelector(".top-panel"),e=0,i=!!t&&t.querySelector(".top-panel__thead"),s=!!t&&t.querySelector(".top-panel__tfoot"),o=BX.pos(this.obTabs).top,a=this.obTabsBlock,n=a.offsetHeight,l=BX.GetWindowScrollPos().scrollTop;if(window.innerWidth<992)if(i&&BX.hasClass(i,"fixed")&&(e=i.offsetHeight,s&&BX.hasClass(s,"visible")&&(e+=s.offsetHeight)),l+e>=o)if(this.tabsPanelFixed)if(!this.tabsPanelScrolled&&e>0&&l<this.lastScrollTop){this.tabsPanelScrolled=!0;var r=this.tabsPanelScrolled;new BX.easing({duration:300,start:{top:Math.abs(parseInt(BX.style(a,"top"),10))},finish:{top:e},transition:BX.easing.transitions.linear,step:function(t){r&&BX.style(a,"top",t.top+"px")}}).animate()}else this.tabsPanelScrolled&&e>0&&l>this.lastScrollTop&&(this.tabsPanelScrolled=!1,new BX.easing({duration:300,start:{top:Math.abs(parseInt(BX.style(a,"top"),10))},finish:{top:e},transition:BX.easing.transitions.linear,step:function(t){BX.style(a,"top",t.top+"px")}}).animate());else this.tabsPanelFixed=!0,BX.style(this.obTabs,"height",n+"px"),BX.style(a,"top",e+"px"),BX.addClass(a,"fixed");else this.tabsPanelFixed&&l+e<o&&(this.tabsPanelFixed=!1,this.tabsPanelScrolled=!1,this.obTabs.removeAttribute("style"),a.removeAttribute("style"),BX.removeClass(a,"fixed"));else t&&BX.hasClass(t,"fixed")&&(e=t.offsetHeight),!this.tabsPanelFixed&&l+e>=o?(this.tabsPanelFixed=!0,BX.style(this.obTabs,"height",n+"px"),BX.style(a,"top",e+"px"),BX.addClass(a,"fixed")):this.tabsPanelFixed&&l+e<o&&(this.tabsPanelFixed=!1,this.obTabs.removeAttribute("style"),a.removeAttribute("style"),BX.removeClass(a,"fixed"));this.lastScrollTop=l},checkTopTabsBlockResize:function(){if(BX.hasClass(this.obTabsBlock,"fixed")){var t=document.querySelector(".top-panel"),e=0,i=!!t&&t.querySelector(".top-panel__thead"),s=!!t&&t.querySelector(".top-panel__tfoot");window.innerWidth<992?i&&BX.hasClass(i,"fixed")&&(e=i.offsetHeight,s&&BX.hasClass(s,"visible")&&(e+=s.offsetHeight)):(t&&BX.hasClass(t,"fixed")&&(e=t.offsetHeight),this.tabsPanelScrolled=!1),BX.style(this.obTabsBlock,"top",e+"px")}},checkActiveTabsBlock:function(){var t=document.querySelector(".top-panel"),e=0,i=!!t&&t.querySelector(".top-panel__thead"),s=!!t&&t.querySelector(".top-panel__tfoot"),o=this.obTabsBlock,a=0,n=this.obTabContainers.querySelectorAll('[data-entity="tab-container"]'),l=this.obTabs.querySelectorAll('[data-entity="tab"]'),r=BX.GetWindowScrollPos().scrollTop;if(n&&l){window.innerWidth<992?i&&BX.hasClass(i,"fixed")&&(e=i.offsetHeight,s&&BX.hasClass(s,"visible")&&(e+=s.offsetHeight)):t&&BX.hasClass(t,"fixed")&&(e=t.offsetHeight),o&&BX.hasClass(o,"fixed")&&(a=o.offsetHeight);var c=r+e+a,h=Object.keys(n).length;for(var d in n)if(n.hasOwnProperty(d)&&BX.type.isDomNode(n[d])){var b=n[d].getAttribute("data-value");if(b)if(c>=BX.pos(n[d]).top&&c<=BX.pos(n[h-1]).bottom){for(var p in l)if(l.hasOwnProperty(p)&&BX.type.isDomNode(l[p])){var B=l[p].getAttribute("data-value");B&&(B===b?BX.addClass(l[p],"active"):BX.removeClass(l[p],"active"))}}else if(c>BX.pos(n[h-1]).bottom)for(var p in l)l.hasOwnProperty(p)&&BX.type.isDomNode(l[p])&&BX.removeClass(l[p],"active")}}},changeTab:function(t){BX.PreventDefault(t),BX.unbind(window,"scroll",BX.proxy(this.checkActiveTabsBlock,this));var e,i,s=BX.proxy_context&&BX.proxy_context.getAttribute("data-value");if(s){if(e=this.obTabContainers.querySelectorAll('[data-entity="tab-container"]'))for(var o in e)if(e.hasOwnProperty(o)&&BX.type.isDomNode(e[o])&&e[o].getAttribute("data-value")===s){var a=document.querySelector(".top-panel"),n=0,l=!!a&&a.querySelector(".top-panel__thead"),r=!!a&&a.querySelector(".top-panel__tfoot"),c=BX.pos(e[o]).top,h=BX.GetWindowScrollPos().scrollTop;window.innerWidth<992?l&&(n=l.offsetHeight,h+this.obTabsBlock.offsetHeight+n>c&&r&&(n+=r.offsetHeight)):a&&(n=a.offsetHeight),new BX.easing({duration:500,start:{scroll:h},finish:{scroll:c-this.obTabsBlock.offsetHeight-n},transition:BX.easing.makeEaseOut(BX.easing.transitions.quint),step:BX.delegate(function(t){window.scrollTo(0,t.scroll)},this),complete:BX.delegate(function(){BX.bind(window,"scroll",BX.proxy(this.checkActiveTabsBlock,this))},this)}).animate()}if(i=this.obTabs.querySelectorAll('[data-entity="tab"]'))for(var o in i)i.hasOwnProperty(o)&&BX.type.isDomNode(i[o])&&(i[o].getAttribute("data-value")===s?BX.addClass(i[o],"active"):BX.removeClass(i[o],"active"))}},initTimer:function(){var itemActiveToStr=this.itemTimer.getAttribute("data-active-to"),itemActiveTo=eval("("+itemActiveToStr+")");Object.keys(itemActiveTo).length>0&&$(this.itemTimer).countdown({until:new Date(itemActiveTo.YYYY,itemActiveTo.MM-1,itemActiveTo.DD,itemActiveTo.HH?itemActiveTo.HH:"00",itemActiveTo.MI?itemActiveTo.MI:"00"),padZeroes:!0,expiryText:BX.message("PROMOTIONS_ITEM_DETAIL_COMPLETED"),alwaysExpire:!0})},initSectionsLinks:function(){var t=this.obSectionsLinks.querySelectorAll(".promotions-detail-section-link"),e=!1;if(t)for(var i in t)t.hasOwnProperty(i)&&BX.type.isDomNode(t[i])&&(BX.bind(t[i],"click",BX.proxy(this.changeSectionLink,this)),e?BX.removeClass(t[i],"active"):(BX.addClass(t[i],"active"),e=!0))},changeSectionLink:function(t){BX.PreventDefault(t);var e=BX.proxy_context&&BX.proxy_context.getAttribute("data-section-id");if(!BX.hasClass(BX.proxy_context,"active")&&e){var i=this.obItem.querySelector(".promotions-detail-products");i&&(i.style.opacity=.2,BX.ajax.post(BX.message("PROMOTION_TEMPLATE_PATH")+"/ajax.php",{action:"changeSectionLink",REQUEST_URI:window.location.href,siteId:BX.message("SITE_ID"),parameters:this.config.PARAMS,productsIds:this.item.productsIds,sectionId:e},BX.delegate(function(t){i.innerHTML=t,this.config.IMG_LAZYLOAD&&imgLazyLoad(),new BX.easing({duration:2e3,start:{opacity:20},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){i.style.opacity=t.opacity/100},complete:function(){i.removeAttribute("style")}}).animate()},this)));var s=this.obSectionsLinks.querySelectorAll(".promotions-detail-section-link");if(s)for(var o in s)s.hasOwnProperty(o)&&BX.type.isDomNode(s[o])&&(s[o].getAttribute("data-section-id")===e?BX.addClass(s[o],"active"):BX.removeClass(s[o],"active"))}}})}();