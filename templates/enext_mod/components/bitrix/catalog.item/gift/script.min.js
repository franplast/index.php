!function(t){"use strict";t.JCGiftItem||(t.JCGiftItem=function(t){if(this.productType=0,this.showAbsent=!0,this.basketAction="ADD",this.showSubscription=!1,this.visual={ID:"",PICT_ID:"",BUY_LINK:"",BASKET_ACTIONS_ID:"",MORE_LINK:"",SUBSCRIBE_LINK:"",PRICE_ID:"",OLD_PRICE_ID:"",TREE_ID:"",BASKET_PROP_DIV:""},this.product={canBuy:!0,name:"",pict:{},id:0,addUrl:"",buyUrl:""},this.basketMode="",this.basketData={useProps:!1,emptyProps:!1,quantity:"quantity",props:"prop",basketUrl:"",sku_props:"",sku_props_var:"basket_props",add_url:"",buy_url:""},this.defaultPict={pict:null},this.canBuy=!0,this.fullDisplayMode=!1,this.viewMode="",this.currentPrices=[],this.currentPriceSelected=0,this.offers=[],this.offerNum=0,this.treeProps=[],this.selectedValues={},this.obProduct=null,this.obPict=null,this.obPrice=null,this.obPriceCurrent=null,this.obPriceOld=null,this.obTree=null,this.obBuyBtn=null,this.obBasketActions=null,this.obMore=null,this.obSubscribe=null,this.obPopupWin=null,this.basketUrl="",this.basketParams={},this.isTouchDevice=BX.hasClass(document.documentElement,"bx-touch"),this.hoverTimer=null,this.hoverStateChangeForbidden=!1,this.useEnhancedEcommerce=!1,this.dataLayerName="dataLayer",this.brandProperty=!1,this.errorCode=0,"object"==typeof t){switch(this.productType=parseInt(t.PRODUCT_TYPE,10),this.showAbsent=t.SHOW_ABSENT,this.showSubscription=t.USE_SUBSCRIBE,t.ADD_TO_BASKET_ACTION&&(this.basketAction=t.ADD_TO_BASKET_ACTION),this.fullDisplayMode="Y"==t.PRODUCT_DISPLAY_MODE,this.viewMode=t.VIEW_MODE||"",this.useEnhancedEcommerce="Y"==t.USE_ENHANCED_ECOMMERCE,this.dataLayerName=t.DATA_LAYER_NAME,this.brandProperty=t.BRAND_PROPERTY,this.visual=t.VISUAL,this.productType){case 0:case 1:case 2:t.PRODUCT&&"object"==typeof t.PRODUCT?(this.currentPrices=t.PRODUCT.ITEM_PRICES,this.currentPriceSelected=t.PRODUCT.ITEM_PRICE_SELECTED,this.canBuy=t.PRODUCT.CAN_BUY,this.product.name=t.PRODUCT.NAME,this.product.pict=t.PRODUCT.PICT,this.product.id=t.PRODUCT.ID,t.PRODUCT.ADD_URL&&(this.product.addUrl=t.PRODUCT.ADD_URL),t.PRODUCT.BUY_URL&&(this.product.buyUrl=t.PRODUCT.BUY_URL),t.BASKET&&"object"==typeof t.BASKET&&(this.basketData.useProps=t.BASKET.ADD_PROPS,this.basketData.emptyProps=t.BASKET.EMPTY_PROPS)):this.errorCode=-1;break;case 3:t.PRODUCT&&"object"==typeof t.PRODUCT&&(this.product.name=t.PRODUCT.NAME,this.product.id=t.PRODUCT.ID),t.OFFERS&&BX.type.isArray(t.OFFERS)&&(this.offers=t.OFFERS,this.offerNum=0,t.OFFER_SELECTED&&(this.offerNum=parseInt(t.OFFER_SELECTED,10)),isNaN(this.offerNum)&&(this.offerNum=0),t.TREE_PROPS&&(this.treeProps=t.TREE_PROPS),t.DEFAULT_PICTURE&&(this.defaultPict.pict=t.DEFAULT_PICTURE.PICTURE));break;default:this.errorCode=-1}t.BASKET&&"object"==typeof t.BASKET&&(t.BASKET.QUANTITY&&(this.basketData.quantity=t.BASKET.QUANTITY),t.BASKET.PROPS&&(this.basketData.props=t.BASKET.PROPS),t.BASKET.BASKET_URL&&(this.basketData.basketUrl=t.BASKET.BASKET_URL),3==this.productType&&t.BASKET.SKU_PROPS&&(this.basketData.sku_props=t.BASKET.SKU_PROPS),t.BASKET.ADD_URL_TEMPLATE&&(this.basketData.add_url=t.BASKET.ADD_URL_TEMPLATE),t.BASKET.BUY_URL_TEMPLATE&&(this.basketData.buy_url=t.BASKET.BUY_URL_TEMPLATE),""==this.basketData.add_url&&""==this.basketData.buy_url&&(this.errorCode=-1024))}0==this.errorCode&&BX.ready(BX.delegate(this.init,this))},t.JCGiftItem.prototype={init:function(){var t=0,e=null;if(this.obProduct=BX(this.visual.ID),this.obProduct||(this.errorCode=-1),this.obPict=BX(this.visual.PICT_ID),this.obPict||(this.errorCode=-2),this.obPrice=BX(this.visual.PRICE_ID),this.obPriceCurrent=this.obPrice.querySelector('[data-entity="price-current"]'),this.obPriceOld=BX(this.visual.OLD_PRICE_ID),this.obPriceMeasure=this.obPrice.querySelector('[data-entity="price-measure"]'),this.obPrice||(this.errorCode=-16),3==this.productType&&this.fullDisplayMode&&this.visual.TREE_ID&&(this.obTree=BX(this.visual.TREE_ID),this.obTree||(this.errorCode=-256)),this.obBasketActions=BX(this.visual.BASKET_ACTIONS_ID),this.obBasketActions&&this.visual.BUY_LINK&&(this.obBuyBtn=BX(this.visual.BUY_LINK)),this.obMore=BX(this.visual.MORE_LINK),this.showSubscription&&(this.obSubscribe=BX(this.visual.SUBSCRIBE_LINK)),0==this.errorCode){switch(this.isTouchDevice||"CARD"==this.viewMode&&(BX.bind(this.obProduct,"mouseenter",BX.proxy(this.hoverOn,this)),BX.bind(this.obProduct,"mouseleave",BX.proxy(this.hoverOff,this))),this.productType){case 0:case 1:case 2:break;case 3:if(this.offers.length>0){if((e=BX.findChildren(this.obTree,{tagName:"li"},!0))&&e.length)for(t=0;t<e.length;t++)BX.bind(e[t],"click",BX.delegate(this.selectOfferProp,this));this.setCurrent()}}this.obBuyBtn&&("ADD"==this.basketAction?BX.bind(this.obBuyBtn,"click",BX.proxy(this.add2Basket,this)):BX.bind(this.obBuyBtn,"click",BX.proxy(this.buyBasket,this)))}},setAnalyticsDataLayer:function(e){if(this.useEnhancedEcommerce&&this.dataLayerName){var s,i,r,o,a,h,n={},u={},c=[];switch(this.productType){case 0:case 1:case 2:n={id:this.product.id,name:this.product.name,price:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,brand:BX.type.isArray(this.brandProperty)?this.brandProperty.join("/"):this.brandProperty};break;case 3:for(s in this.offers[this.offerNum].TREE)if(this.offers[this.offerNum].TREE.hasOwnProperty(s))for(i in o=s.substring(5),a=this.offers[this.offerNum].TREE[s],this.treeProps)if(this.treeProps.hasOwnProperty(i)&&this.treeProps[i].ID==o)for(r in this.treeProps[i].VALUES)if((h=this.treeProps[i].VALUES[r]).ID==a){c.push(h.NAME);break}n={id:this.offers[this.offerNum].ID,name:this.offers[this.offerNum].NAME,price:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,brand:BX.type.isArray(this.brandProperty)?this.brandProperty.join("/"):this.brandProperty,variant:c.join("/")}}switch(e){case"addToCart":(u={event:"addToCart",ecommerce:{currencyCode:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].CURRENCY||"",add:{products:[{name:n.name||"",id:n.id||"",price:n.price||0,brand:n.brand||"",category:n.category||"",variant:n.variant||""}]}}}).ecommerce.add.products[0].quantity=this.currentPrices[this.currentPriceSelected]?this.currentPrices[this.currentPriceSelected].MIN_QUANTITY:""}t[this.dataLayerName]=t[this.dataLayerName]||[],t[this.dataLayerName].push(u)}},hoverOn:function(t){clearTimeout(this.hoverTimer),this.obProduct.style.height=getComputedStyle(this.obProduct).height,BX.addClass(this.obProduct,"hover"),BX.PreventDefault(t)},hoverOff:function(t){this.hoverStateChangeForbidden||(BX.removeClass(this.obProduct,"hover"),this.hoverTimer=setTimeout(BX.delegate(function(){this.obProduct.style.height="auto"},this),300),BX.PreventDefault(t))},quantitySet:function(t){var e=this.offers[t];if(0==this.errorCode){this.canBuy=e.CAN_BUY,this.currentPrices=e.ITEM_PRICES,this.currentPriceSelected=e.ITEM_PRICE_SELECTED;var s=this.currentPrices[this.currentPriceSelected],i=e.PARTNERS_URL;this.canBuy?(s?i?(this.obBuyBtn&&BX.style(this.obBuyBtn,"display","none"),this.obMore&&BX.style(this.obMore,"display","")):(this.obBuyBtn&&BX.adjust(this.obBuyBtn,{props:{disabled:!1},style:{display:""}}),this.obMore&&BX.style(this.obMore,"display","none")):i?(this.obBuyBtn&&BX.style(this.obBuyBtn,"display","none"),this.obMore&&BX.style(this.obMore,"display","")):(this.obBuyBtn&&BX.adjust(this.obBuyBtn,{props:{disabled:!0},style:{display:""}}),this.obMore&&BX.style(this.obMore,"display","none")),this.obSubscribe&&BX.style(this.obSubscribe,"display","none")):this.obSubscribe?"Y"==e.CATALOG_SUBSCRIBE?(BX.style(this.obSubscribe,"display",""),this.obSubscribe.setAttribute("data-item",e.ID),BX(this.visual.SUBSCRIBE_LINK+"_hidden").click(),this.obBuyBtn&&BX.adjust(this.obBuyBtn,{props:{disabled:!0},style:{display:"none"}}),this.obMore&&BX.style(this.obMore,"display","none")):(BX.style(this.obSubscribe,"display","none"),i?(this.obBuyBtn&&BX.style(this.obBuyBtn,"display","none"),this.obMore&&BX.style(this.obMore,"display","")):(this.obBuyBtn&&BX.adjust(this.obBuyBtn,{props:{disabled:!0},style:{display:""}}),this.obMore&&BX.style(this.obMore,"display","none"))):i?(this.obBuyBtn&&BX.style(this.obBuyBtn,"display","none"),this.obMore&&BX.style(this.obMore,"display","")):(this.obBuyBtn&&BX.adjust(this.obBuyBtn,{props:{disabled:!0},style:{display:""}}),this.obMore&&BX.style(this.obMore,"display","none")),this.obPriceMeasure&&(e.MEASURE?BX.adjust(this.obPriceMeasure,{html:"/"+e.MEASURE}):BX.adjust(this.obPriceMeasure,{html:""}))}},selectOfferProp:function(){var t=0,e=[],s=null,i=BX.proxy_context;if(i&&i.hasAttribute("data-treevalue")){if(BX.hasClass(i,"selected"))return;if(e=i.getAttribute("data-treevalue").split("_"),this.searchOfferPropIndex(e[0],e[1])&&(s=BX.findChildren(i.parentNode,{tagName:"li"},!1))&&0<s.length)for(t=0;t<s.length;t++)s[t].getAttribute("data-onevalue")==e[1]?BX.addClass(s[t],"selected"):BX.removeClass(s[t],"selected")}},searchOfferPropIndex:function(t,e){var s,i,r="",o=!1,a=[],h=[],n=-1,u={},c=[];for(s=0;s<this.treeProps.length;s++)if(this.treeProps[s].ID==t){n=s;break}if(-1<n){for(s=0;s<n;s++)u[r="PROP_"+this.treeProps[s].ID]=this.selectedValues[r];if(r="PROP_"+this.treeProps[n].ID,!(o=this.getRowValues(u,r)))return!1;if(!BX.util.in_array(e,o))return!1;for(u[r]=e,s=n+1;s<this.treeProps.length;s++){if(r="PROP_"+this.treeProps[s].ID,!(o=this.getRowValues(u,r)))return!1;if(h=[],this.showAbsent)for(a=[],c=[],c=BX.clone(u,!0),i=0;i<o.length;i++)c[r]=o[i],h[h.length]=o[i],this.getCanBuy(c)&&(a[a.length]=o[i]);else a=o;this.selectedValues[r]&&BX.util.in_array(this.selectedValues[r],a)?u[r]=this.selectedValues[r]:this.showAbsent?u[r]=a.length>0?a[0]:h[0]:u[r]=a[0],this.updateRow(s,u[r],o,a)}this.selectedValues=u,this.changeInfo()}return!0},updateRow:function(t,e,s,i){var r,o=0,a="",h=!1,n=null,u=this.obTree.querySelectorAll('[data-entity="sku-line-block"]');if(t>-1&&t<u.length&&(r=u[t].querySelector("ul"),(n=BX.findChildren(r,{tagName:"li"},!1))&&0<n.length))for(o=0;o<n.length;o++)(h=(a=n[o].getAttribute("data-onevalue"))==e)?BX.addClass(n[o],"selected"):BX.removeClass(n[o],"selected"),BX.util.in_array(a,i)?BX.removeClass(n[o],"notallowed"):BX.addClass(n[o],"notallowed"),n[o].style.display=BX.util.in_array(a,s)?"":"none",h&&(u[t].style.display=0==a&&1==i.length?"none":"")},getRowValues:function(t,e){var s,i=0,r=[],o=!1,a=!0;if(0==t.length){for(i=0;i<this.offers.length;i++)BX.util.in_array(this.offers[i].TREE[e],r)||(r[r.length]=this.offers[i].TREE[e]);o=!0}else for(i=0;i<this.offers.length;i++){for(s in a=!0,t)if(t[s]!==this.offers[i].TREE[s]){a=!1;break}a&&(BX.util.in_array(this.offers[i].TREE[e],r)||(r[r.length]=this.offers[i].TREE[e]),o=!0)}return!!o&&r},getCanBuy:function(t){var e,s,i=!1,r=!0;for(e=0;e<this.offers.length;e++){for(s in r=!0,t)if(t[s]!==this.offers[e].TREE[s]){r=!1;break}if(r&&this.offers[e].CAN_BUY){i=!0;break}}return i},setCurrent:function(){var t,e=0,s=[],i="",r=!1,o={},a=[],h=this.offers[this.offerNum].TREE;for(t=0;t<this.treeProps.length&&(i="PROP_"+this.treeProps[t].ID,r=this.getRowValues(o,i));t++){if(BX.util.in_array(h[i],r)?o[i]=h[i]:(o[i]=r[0],this.offerNum=0),this.showAbsent)for(s=[],a=[],a=BX.clone(o,!0),e=0;e<r.length;e++)a[i]=r[e],this.getCanBuy(a)&&(s[s.length]=r[e]);else s=r;this.updateRow(t,o[i],r,s)}this.selectedValues=o,this.changeInfo()},changeInfo:function(){var t,e,s=-1,i=!0;for(t=0;t<this.offers.length;t++){for(e in i=!0,this.selectedValues)if(this.selectedValues[e]!==this.offers[t].TREE[e]){i=!1;break}if(i){s=t;break}}s>-1&&(this.obPict&&(this.obPictImg=BX.findChild(this.obPict,{tagName:"IMG"},!0,!1),this.obPictImg&&(this.offers[s].PREVIEW_PICTURE?BX.adjust(this.obPictImg,{props:{src:this.offers[s].PREVIEW_PICTURE.SRC,width:this.offers[s].PREVIEW_PICTURE.WIDTH,height:this.offers[s].PREVIEW_PICTURE.HEIGHT}}):BX.adjust(this.obPictImg,{props:{src:this.defaultPict.pict.SRC,width:this.defaultPict.pict.WIDTH,height:this.defaultPict.pict.HEIGHT}})),this.obPict.style.display=""),this.quantitySet(s),this.setPrice(),this.setBuyedAdded(this.offers[s].BUYED_ADDED),this.offerNum=s)},setPrice:function(){var t=this.currentPrices[this.currentPriceSelected];t?(this.obPriceCurrent&&BX.adjust(this.obPriceCurrent,{html:BX.Currency.currencyFormat(t.PRICE,t.CURRENCY,!0),style:{display:""}}),this.obPriceOld&&BX.adjust(this.obPriceOld,{html:t.BASE_PRICE>0?BX.Currency.currencyFormat(t.BASE_PRICE,t.CURRENCY,!0):"",style:{display:t.BASE_PRICE>0?"":"none"}})):(this.obPriceCurrent&&BX.adjust(this.obPriceCurrent,{html:"",style:{display:"none"}}),this.obPriceOld&&BX.adjust(this.obPriceOld,{html:"",style:{display:"none"}}))},setBuyedAdded:function(t){this.obBuyBtn&&(t?(BX.adjust(this.obBuyBtn,{props:{className:"btn btn-buy-ok",title:BX.message("ADD_BASKET_OK_MESSAGE")},html:'<i class="icon-ok-b"></i>'}),BX.unbindAll(this.obBuyBtn),BX.bind(this.obBuyBtn,"click",BX.delegate(this.basketRedirect,this))):(BX.adjust(this.obBuyBtn,{props:{className:"btn btn-buy",title:BX.message("ADD_BASKET_MESSAGE")},html:'<i class="icon-cart"></i>'}),BX.unbindAll(this.obBuyBtn),BX.bind(this.obBuyBtn,"click",BX.proxy("BUY"==this.basketAction?this.buyBasket:this.add2Basket,this))))},setBuyAddInfo:function(t){if(BX.type.isArray(t))for(var e in this.offers)this.offers.hasOwnProperty(e)&&(this.offers[e].BUYED_ADDED=BX.util.in_array(this.offers[e].ID,t))},initBasketUrl:function(){switch(this.basketUrl="ADD"==this.basketMode?this.basketData.add_url:this.basketData.buy_url,this.productType){case 1:case 2:this.basketUrl=this.basketUrl.replace("#ID#",this.product.id.toString());break;case 3:this.basketUrl=this.basketUrl.replace("#ID#",this.offers[this.offerNum].ID)}this.basketParams={ajax_basket:"Y"},this.basketParams[this.basketData.quantity]=this.currentPrices[this.currentPriceSelected]?this.currentPrices[this.currentPriceSelected].MIN_QUANTITY:"",this.basketData.sku_props&&(this.basketParams[this.basketData.sku_props_var]=this.basketData.sku_props)},fillBasketProps:function(){if(this.visual.BASKET_PROP_DIV){var t=0,e=null,s=!1,i=null;if((i=BX(this.visual.BASKET_PROP_DIV))&&(e=i.getElementsByTagName("input"))&&e.length)for(t=0;t<e.length;t++)if(!e[t].disabled)switch(e[t].type.toLowerCase()){case"hidden":this.basketParams[e[t].name]=e[t].value,s=!0;break;case"radio":e[t].checked&&(this.basketParams[e[t].name]=e[t].value,s=!0)}s||(this.basketParams[this.basketData.props]=[],this.basketParams[this.basketData.props][0]=0)}},showBasketPropsDropDownPopup:function(t,e){var s=t.querySelector('[data-entity="dropdownContent"]');this.obPopupWin&&this.obPopupWin.close(),this.obPopupWin=BX.PopupWindowManager.create("basketPropsDropDown"+e+"_"+this.visual.ID,t,{autoHide:!0,offsetLeft:0,offsetTop:3,overlay:!1,draggable:{restrict:!0},closeByEsc:!0,className:"bx-drop-down-popup-window",content:BX.clone(s)}),s.parentNode.appendChild(BX("basketPropsDropDown"+e+"_"+this.visual.ID)),this.obPopupWin.show()},selectBasketPropsDropDownPopupItem:function(t,e){var s=BX.findParent(t,{className:"product-item-basket-props-drop-down"},!1),i=s.querySelector("INPUT"),r=s.querySelector('[data-entity="current-option"]');i.value=e,r.innerHTML=t.innerHTML,BX.PopupWindowManager.getCurrentPopup().close()},add2Basket:function(){this.basketMode="ADD",this.basket()},buyBasket:function(){this.basketMode="BUY",this.basket()},sendToBasket:function(){this.canBuy&&(this.initBasketUrl(),this.fillBasketProps(),BX.ajax({method:"POST",dataType:"json",url:this.basketUrl,data:this.basketParams,onsuccess:BX.proxy(this.basketResult,this)}))},basket:function(){this.canBuy&&this.sendToBasket()},basketResult:function(e){if("OK"==e.STATUS)if("BUY"==this.basketMode)this.basketRedirect();else{var s,i,r=this.obProduct.querySelector('[data-entity="image-wrapper"]');switch(this.productType){case 1:case 2:s=this.product.pict.SRC,i=this.product.pict.WIDTH;break;case 3:s=this.offers[this.offerNum].PREVIEW_PICTURE?this.offers[this.offerNum].PREVIEW_PICTURE.SRC:this.defaultPict.pict.SRC,i=this.offers[this.offerNum].PREVIEW_PICTURE?this.offers[this.offerNum].PREVIEW_PICTURE.WIDTH:this.defaultPict.pict.WIDTH}s&&document.body.appendChild(BX.create("IMG",{props:{className:"animated-image"},style:{width:i+"px",position:"absolute","z-index":"1100"},attrs:{src:s}}));var o=document.body.querySelector(".animated-image");if(o){var a=document.querySelector(".top-panel").querySelector(".mini-cart__cart");new BX.easing({duration:500,start:{width:Number(i),left:BX.pos(r).left,top:BX.pos(r).top},finish:{width:70,left:BX.pos(a).left,top:BX.pos(a).top},transition:BX.easing.transitions.linear,step:BX.delegate(function(t){o.style.width=t.width+"px",o.style.left=t.left+"px",o.style.top=t.top+"px"},this),complete:BX.delegate(function(){BX.remove(o),this.setBuyedAdded(!0),this.offers.length>0&&(this.offers[this.offerNum].BUYED_ADDED=!0),BX.onCustomEvent("OnBasketChange"),this.setAnalyticsDataLayer("addToCart"),"/personal/cart/"==t.location.pathname&&setTimeout(function(){t.location.reload(!0)},1e3)},this)}).animate()}}},basketRedirect:function(){t.location.href=this.basketData.basketUrl?this.basketData.basketUrl:BX.message("BASKET_URL")}})}(window);