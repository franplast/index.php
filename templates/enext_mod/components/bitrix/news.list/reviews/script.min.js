!function(e){"use strict";e.JCNewsListReviewsComponent||(e.JCNewsListReviewsComponent=function(e){this.formPosting=!1,this.siteId=e.siteId||"",this.template=e.template||"",this.templatePath=e.templatePath||"",this.parameters=e.parameters||"",e.navParams&&(this.navParams={NavNum:e.navParams.NavNum||1,NavPageNomer:parseInt(e.navParams.NavPageNomer)||1,NavPageCount:parseInt(e.navParams.NavPageCount)||1}),this.container=document.querySelector("[data-entity='container-"+this.navParams.NavNum+"']"),this.showMoreButton=null,this.showMoreButtonMessage=null,this.showMoreButtonContainer=null,e.lazyLoad&&(this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]'),this.showMoreButtonMessage=this.showMoreButton.innerHTML,this.showMoreButtonContainer=document.querySelector('[data-entity="reviews-show-more-container"]'),BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this))),this.evaluationStars=document.body.querySelector(".reviews-evaluation-stars"),this.evaluationStars&&BX.ready(BX.delegate(this.initEvaluationStars,this)),this.addReviewButton=document.body.querySelector('[data-entity="addReview"]'),this.addReviewButton&&BX.bind(this.addReviewButton,"click",BX.proxy(this.addReview,this)),this.ratingList=document.body.querySelector(".reviews-general-stats-rating-list"),this.ratingList&&BX.ready(BX.delegate(this.initRatingList,this))},e.JCNewsListReviewsComponent.prototype={checkButton:function(){this.showMoreButton&&(this.navParams.NavPageNomer==this.navParams.NavPageCount?BX.remove(this.showMoreButtonContainer):this.container.appendChild(this.showMoreButtonContainer))},enableButton:function(){this.showMoreButton&&(BX.removeClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=this.showMoreButtonMessage)},disableButton:function(){this.showMoreButton&&(BX.addClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=BX.message("REVIEWS_LOADING"))},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var t={action:"showMoreReviews"};t.REQUEST_URI=e.location.pathname,t["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1,this.formPosting||(this.formPosting=!0,this.disableButton(),this.sendRequest(t))}},sendRequest:function(e){var t={siteId:this.siteId,template:this.template,parameters:this.parameters},i=!!this.ratingList&&this.ratingList.querySelectorAll(".reviews-general-stats-rating-item-container");if(i)for(var s in i)i.hasOwnProperty(s)&&BX.type.isDomNode(i[s])&&BX.hasClass(i[s],"active")&&(t.ratingId=i[s].getAttribute("data-rating-id"));BX.ajax({url:this.templatePath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(t,e),onsuccess:BX.delegate(function(e){e&&e.JS&&BX.ajax.processScripts(BX.processHTML(e.JS).SCRIPT,!1,BX.delegate(function(){this.processShowMoreAction(e)},this))},this)})},processShowMoreAction:function(e){this.formPosting=!1,this.enableButton(),e&&(this.navParams.NavPageNomer++,this.processItems(e.items),this.checkButton())},processItems:function(e,t){if(e){var i,s=BX.processHTML(e,!1),a=BX.create("DIV");if(a.innerHTML=s.HTML,(i=a.querySelectorAll('[data-entity="item"]')).length){for(var o in i)i.hasOwnProperty(o)&&(i[o].style.opacity=0,this.container.appendChild(i[o]));new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){for(var t in i)i.hasOwnProperty(t)&&(i[t].style.opacity=e.opacity/100)},complete:function(){for(var e in i)i.hasOwnProperty(e)&&i[e].removeAttribute("style")}}).animate()}BX.ajax.processScripts(s.SCRIPT)}},initEvaluationStars:function(){var e=this.evaluationStars.querySelectorAll(".reviews-evaluation-star"),t=document.body.querySelector(".reviews-evaluation-val");e&&(BX.bind(this.evaluationStars,"click",BX.delegate(function(t){var i=t.target;if(BX.hasClass(i,"reviews-evaluation-star")){for(var s in e)e.hasOwnProperty(s)&&BX.type.isDomNode(e[s])&&BX.removeClass(e[s],"reviews-evaluation-star-current");BX.addClass(i,"reviews-evaluation-star-current"),this.addReview()}},this)),BX.bind(this.evaluationStars,"mouseover",BX.delegate(function(i){var s=i.target;if(BX.hasClass(s,"reviews-evaluation-star")){for(var a in t&&(t.innerHTML=s.getAttribute("data-value")),e)e.hasOwnProperty(a)&&BX.type.isDomNode(e[a])&&BX.removeClass(e[a],"reviews-evaluation-star-active");for(var a in BX.addClass(s,"reviews-evaluation-star-active"),e)if(e.hasOwnProperty(a)&&BX.type.isDomNode(e[a])){if(BX.hasClass(e[a],"reviews-evaluation-star-active"))break;BX.addClass(e[a],"reviews-evaluation-star-active")}}},this)),BX.bind(this.evaluationStars,"mouseout",BX.delegate(function(){for(var i in t&&(t.innerHTML=BX.message("REVIEWS_EVALUATION_VALUE")),e)e.hasOwnProperty(i)&&BX.type.isDomNode(e[i])&&BX.addClass(e[i],"reviews-evaluation-star-active");for(i=Object.keys(e).length;i>=0;i--)if(e.hasOwnProperty(i)&&BX.type.isDomNode(e[i])){if(BX.hasClass(e[i],"reviews-evaluation-star-current")){t&&(t.innerHTML=e[i].getAttribute("data-value"));break}BX.removeClass(e[i],"reviews-evaluation-star-active")}},this)))},addReview:function(){var t=BX.proxy_context,i=document.body.querySelector(".slide-panel");if(i){var s={action:"addReview",parameters:this.parameters};if(BX.hasClass(t,"reviews-evaluation-stars")){var a=t.querySelectorAll(".reviews-evaluation-star");if(a)for(var o in a)a.hasOwnProperty(o)&&BX.type.isDomNode(a[o])&&(BX.hasClass(a[o],"reviews-evaluation-star-current")&&(s.ratingId=a[o].getAttribute("data-rating-id")),BX.adjust(a[o],{props:{className:"icon-star-s reviews-evaluation-star"}}))}BX.ajax.post(this.templatePath+"/ajax.php",s,function(t){i.appendChild(BX.create("DIV",{props:{className:"slide-panel__title-wrap"},children:[BX.create("I",{props:{className:"icon-comment"}}),BX.create("SPAN",{props:{className:"slide-panel__title"},html:BX.message("REVIEWS_YOUR_REVIEW")}),BX.create("SPAN",{props:{className:"slide-panel__close"},children:[BX.create("I",{props:{className:"icon-close"}})]})]})),i.appendChild(BX.create("DIV",{props:{className:"slide-panel__content scrollbar-inner"},html:t}));var s=i.querySelector(".slide-panel__content");s&&$(s).scrollbar();var a=e.innerWidth-document.body.clientWidth;if(a>0){BX.style(document.body,"padding-right",a+"px");var o=document.querySelector(".page-bg");o&&BX.style(o,"margin-right",a+"px");var r=document.querySelector(".top-panel");if(r){BX.hasClass(r,"fixed")&&BX.style(r,"padding-right",a+"px");var n=r.querySelector(".top-panel__thead");n&&BX.hasClass(n,"fixed")&&BX.style(n,"padding-right",a+"px");var l=r.querySelector(".top-panel__tfoot");l&&BX.hasClass(l,"fixed")&&BX.style(l,"padding-right",a+"px")}var h=document.querySelector('[data-entity="tabs"]');h&&BX.hasClass(h,"fixed")&&BX.style(h,"padding-right",a+"px")}var c=BX.GetWindowScrollPos().scrollTop;c&&c>0&&BX.style(document.body,"top","-"+c+"px"),BX.addClass(document.body,"slide-panel-active"),BX.addClass(i,"active"),document.body.appendChild(BX.create("DIV",{props:{className:"modal-backdrop slide-panel__backdrop fadeInBig"}}))})}},initRatingList:function(){var e=this.ratingList.querySelectorAll(".reviews-general-stats-rating-item-container");if(e)for(var t in e)e.hasOwnProperty(t)&&BX.type.isDomNode(e[t])&&(BX.hasClass(e[t],"disabled")||BX.bind(e[t],"click",BX.proxy(this.changeRatingItem,this)))},changeRatingItem:function(t){BX.PreventDefault(t);var i=BX.proxy_context&&BX.proxy_context.getAttribute("data-rating-id");if(!BX.hasClass(BX.proxy_context,"active")&&i){var s=document.body.querySelector(".reviews-items-container");s&&(s.style.opacity=.2,BX.ajax({url:this.templatePath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:{action:"changeRatingItem",REQUEST_URI:e.location.pathname,siteId:this.siteId,template:this.template,parameters:this.parameters,ratingId:i},onsuccess:BX.delegate(function(e){e&&e.JS&&BX.ajax.processScripts(BX.processHTML(e.JS).SCRIPT,!1,BX.delegate(function(){if(BX.cleanNode(s),e.items){var t=BX.processHTML(e.items,!1);(a=BX.create("DIV")).innerHTML=t.HTML;var i=a.querySelector(".reviews-items");i&&(s.appendChild(i),this.container=i),BX.ajax.processScripts(t.SCRIPT)}if(e.showMore){var a;(a=BX.create("DIV")).innerHTML=e.showMore;var o=a.querySelector(".reviews-more");o&&(s.appendChild(o),this.showMoreButtonContainer=o,this.showMoreButton=o.querySelector(".btn-more"),this.showMoreButtonMessage=this.showMoreButton.innerHTML,BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this)))}new BX.easing({duration:2e3,start:{opacity:20},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){s.style.opacity=e.opacity/100},complete:function(){s.removeAttribute("style")}}).animate()},this))},this)}));var a=this.ratingList.querySelectorAll(".reviews-general-stats-rating-item-container");if(a)for(var o in a)a.hasOwnProperty(o)&&BX.type.isDomNode(a[o])&&(a[o].getAttribute("data-rating-id")===i?BX.addClass(a[o],"active"):BX.removeClass(a[o],"active"))}}}),e.JCNewsListReviews||(e.JCNewsListReviews=function(e){this.visual={ID:""},this.item={iblockId:0,id:0},this.obItem=null,this.obLike=null,this.obLikes=null,this.errorCode=0,"object"==typeof e&&(this.visual=e.VISUAL,this.item.iblockId=e.ITEM.IBLOCK_ID,this.item.id=e.ITEM.ID,BX.ready(BX.delegate(this.init,this)))},e.JCNewsListReviews.prototype={init:function(){this.obItem=BX(this.visual.ID),this.obItem||(this.errorCode=-1),0===this.errorCode&&(this.checkLiked(),this.obLike=this.obItem.querySelector('[data-entity="like"]'),this.obLike&&BX.bind(this.obLike,"click",BX.proxy(this.like,this)),this.obLikes=this.obItem.querySelector(".reviews-item-likes"))},checkLiked:function(){BX.ajax({url:BX.message("REVIEWS_TEMPLATE_PATH")+"/ajax.php",method:"POST",dataType:"json",timeout:60,data:{action:"checkLiked",iblockId:this.item.iblockId,reviewId:this.item.id},onsuccess:BX.delegate(function(e){this.setLiked(!!e.liked)},this)})},like:function(){var e=BX.hasClass(this.obLike,"reviews-item-liked");BX.ajax({url:BX.message("REVIEWS_TEMPLATE_PATH")+"/ajax.php",method:"POST",dataType:"json",timeout:60,data:{action:e?"deleteLike":"addLike",iblockId:this.item.iblockId,reviewId:this.item.id},onsuccess:BX.delegate(function(e){this.setLiked(!!e.liked),e.likes&&this.setLikes(e.likes)},this)})},setLiked:function(e){if(this.obLike){e?BX.addClass(this.obLike,"reviews-item-liked"):BX.removeClass(this.obLike,"reviews-item-liked");var t=this.obLike.querySelector('[data-entity="like-icon"]');t&&BX.adjust(t,{props:{className:e?"icon-heart-s":"icon-heart-b"}})}},setLikes:function(e){if(this.obLikes)if("plus"==e)this.obLikes.innerHTML="+"+(parseInt(this.obLikes.innerHTML,10)+1),BX.hasClass(this.obLikes,"reviews-item-likes-empty")&&BX.removeClass(this.obLikes,"reviews-item-likes-empty");else if("minus"==e){var t=parseInt(this.obLikes.innerHTML,10)-1;this.obLikes.innerHTML=(t>0?"+":"")+t,0==t&&BX.addClass(this.obLikes,"reviews-item-likes-empty")}}})}(window);